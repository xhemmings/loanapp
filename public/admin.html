<!doctype html><html lang="en">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Applications</title>
<style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px}h1{margin:0 0 12px}.bar{display:flex;gap:8px;align-items:center;margin-bottom:12px}input,button,select{padding:8px 10px;font-size:14px}table{border-collapse:collapse;width:100%;font-size:14px}th,td{border:1px solid #ddd;padding:8px;vertical-align:top}th{background:#f5f5f7;text-align:left;position:sticky;top:0}.muted{color:#666;font-size:12px}</style></head>
<body><h1>Applications</h1><div class="bar"><label for="limit">Limit</label><select id="limit"><option>25</option><option selected>100</option><option>200</option><option>500</option></select><button id="refresh">Refresh</button><span id="status" class="muted"></span></div>
<div style="overflow:auto"><table id="tbl"><thead><tr><th>Application ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Address</th><th>Parish</th><th>Term</th><th>Promotion</th><th>Created</th></tr></thead><tbody></tbody></table></div>
<script>
async function fetchRows(){const limit=document.getElementById('limit').value||100;const status=document.getElementById('status');status.textContent='Loadingâ€¦';
  const res=await fetch(`/applications?limit=${encodeURIComponent(limit)}`,{headers:{'Accept':'application/json'/*,'x-api-key':'YOUR_KEY'*/}});
  if(!res.ok){status.textContent=`Error ${res.status}`;return;}
  const json=await res.json();if(!json.ok){status.textContent=`Error: ${json.error||'unknown'}`;return;}
  const tbody=document.querySelector('#tbl tbody');tbody.innerHTML='';
  for(const r of json.rows){const tr=document.createElement('tr');tr.innerHTML=`
    <td>${esc(r.application_id)}</td>
    <td>${esc(r.first_name)} ${esc(r.last_name)}</td>
    <td>${esc(r.email)}</td>
    <td>${esc(r.phone_full||'')}</td>
    <td>${esc(r.address1)}${r.address2?'<br/><span class="muted">'+esc(r.address2)+'</span>':''}</td>
    <td>${esc(r.parish||'')}</td>
    <td>${esc(r.term_months??'')}</td>
    <td>${esc(r.promotion_id??'')}</td>
    <td>${fmtDate(r.created_at)}</td>`;tbody.appendChild(tr);}
  status.textContent=`Loaded ${json.rows.length} row(s).`;}
function esc(s){return (s??'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;')}
function fmtDate(v){if(!v)return'';try{return new Date(v).toLocaleString()}catch{return v}}
document.getElementById('refresh').addEventListener('click',fetchRows);document.addEventListener('DOMContentLoaded',fetchRows);
</script></body></html>