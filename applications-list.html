<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loan Application System — Applications</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    :root{--primary:#1a2a6c;--secondary:#2a4cb3;--accent:#3a6ee0;--light:#e3f2fd;--dark:#0d1b3a;--darker:#080f23;--table-border:rgba(255,255,255,.15);--table-header:rgba(0,0,0,.3)}
    body{background:linear-gradient(135deg,var(--dark),var(--primary));color:#fff;min-height:100vh;padding:15px}
    .container{max-width:1000px;margin:0 auto;background:rgba(255,255,255,.05);border-radius:15px;padding:20px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 30px rgba(0,0,0,.3)}
    header{text-align:center;padding:15px 0;margin-bottom:15px;border-bottom:1px solid rgba(255,255,255,.1)}
    .logo{font-size:32px;margin-bottom:8px;color:var(--accent)}
    h1{font-size:28px;margin-bottom:5px}
    .subtitle{color:#c3cfe2;font-size:16px;margin-bottom:20px}
    .navigation{display:flex;justify-content:space-between;margin-bottom:20px;gap:10px}
    .btn{background:var(--accent);color:#fff;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:500;transition:.3s;display:inline-flex;align-items:center;justify-content:center;text-decoration:none;flex:1}
    .btn i{margin-right:8px}
    .btn:hover{background:var(--secondary);transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.2)}
    .btn-secondary{background:rgba(255,255,255,.1)}
    .btn-secondary:hover{background:rgba(255,255,255,.2)}
    .filter-bar{display:flex;gap:12px;align-items:center;margin-bottom:20px;padding:15px;background:rgba(255,255,255,.05);border-radius:12px;flex-wrap:wrap;border:1px solid rgba(255,255,255,.1)}
    .filter-bar label{color:#bbdefb;font-weight:500;font-size:14px}
    .filter-bar select,.filter-bar input{padding:10px 12px;border-radius:8px;background:#0d1b3a;border:1px solid rgba(255,255,255,.2);color:#fff;font-size:14px;flex:1;min-width:120px}
    .filter-bar select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23bbdefb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}
    .status{color:#bbdefb;margin-left:auto;font-size:14px;text-align:center}
    .table-container{overflow:auto;border-radius:12px;background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border:1px solid var(--table-border);margin-bottom:20px;max-height:60vh;box-shadow:0 5px 15px rgba(0,0,0,.2)}
    table{width:100%;border-collapse:separate;border-spacing:0;font-size:14px;min-width:900px}
    th,td{padding:14px 12px;text-align:left;border-right:1px solid var(--table-border);white-space:nowrap}
    th{background:var(--table-header);font-weight:600;position:sticky;top:0;font-size:13px;border-bottom:2px solid var(--table-border);color:#e3f2fd}
    th:last-child,td:last-child{border-right:none}
    tr{border-bottom:1px solid var(--table-border)}
    tr:last-child{border-bottom:none}
    tr:hover{background:rgba(255,255,255,.05)}
    .empty-state{text-align:center;padding:50px 15px;color:#bbdefb}
    .empty-state i{font-size:48px;margin-bottom:15px;color:var(--accent);opacity:.7}
    .empty-state h3{font-size:20px;margin-bottom:10px;font-weight:500}
    .empty-state p{font-size:15px;opacity:.8}
    footer{text-align:center;padding:20px 0;margin-top:30px;border-top:1px solid rgba(255,255,255,.1);color:#bbdefb;font-size:14px}
    .mobile-menu-btn{display:none;background:var(--accent);color:#fff;border:none;padding:10px 15px;border-radius:8px;cursor:pointer;margin-bottom:15px;width:100%;justify-content:center;align-items:center;gap:8px}
    @media (max-width:768px){body{padding:10px}.container{padding:15px;border-radius:12px}.navigation{flex-direction:column}.btn{width:100%}.filter-bar{flex-direction:column;align-items:stretch;gap:10px}.filter-bar select,.filter-bar input{width:100%;min-width:auto}.mobile-menu-btn{display:flex}th,td{padding:10px 8px;font-size:13px}.empty-state{padding:30px 10px}.empty-state i{font-size:36px}footer{padding:15px 0;font-size:13px}}
    @media (max-width:480px){.container{padding:12px}h1{font-size:22px}.btn{font-size:14px;padding:10px}th,td{padding:8px 6px;font-size:12px}}
  </style>
</head>
<body>
  <div class="container">
    <button class="mobile-menu-btn"><i class="fas fa-bars"></i> Menu</button>
    <header>
      <div class="logo"><i class="fas fa-hand-holding-usd"></i></div>
      <h1>Loan Application System</h1>
      <p class="subtitle">Applications List (Live Data)</p>
    </header>

    <div class="navigation">
      <a href="admin.html" class="btn btn-secondary"><i class="fas fa-gauge"></i> Test Dashboard</a>
      <button id="refresh-btn" class="btn"><i class="fas fa-sync-alt"></i> Refresh</button>
    </div>

    <div class="filter-bar">
      <label for="limit">Show</label>
      <select id="limit">
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100" selected>100</option>
        <option value="200">200</option>
        <option value="500">500</option>
      </select>
      <input type="text" id="search" placeholder="Search name, email, or ID..." />
      <span id="status" class="status">Loading…</span>
    </div>

    <div class="table-container">
      <table id="applications-table">
        <thead>
          <tr>
            <th>App ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Parish</th>
            <th>Term</th>
            <th>Promotion</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
      <div id="empty-state" class="empty-state" style="display:none">
        <i class="fas fa-database"></i>
        <h3>No Applications</h3>
        <p>Try increasing the limit or removing filters.</p>
      </div>
    </div>

    <footer>
      <p>Loan Application System &copy; 2025 | Dox Services</p>
      <p><i class="fas fa-lock"></i> Served from the live database</p>
    </footer>
  </div>

  <script>
    function esc(s){return (s??'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;')}
    function fmtDate(v){if(!v)return'';try{return new Date(v).toLocaleString()}catch{return v}}

    async function fetchApplications(){
      const limit = document.getElementById('limit').value || 100;
      const q = (document.getElementById('search').value||'').toLowerCase();
      const statusEl = document.getElementById('status');
      const tbody = document.getElementById('table-body');
      const table = document.getElementById('applications-table');
      const empty = document.getElementById('empty-state');
      statusEl.textContent = 'Loading…';

      try{
        const res = await fetch(`/applications?limit=${encodeURIComponent(limit)}`, { headers: { 'Accept':'application/json' } });
        if(!res.ok){ statusEl.textContent = `Error ${res.status}`; return; }
        const json = await res.json();
        if(!json.ok){ statusEl.textContent = `Error: ${json.error||'unknown'}`; return; }

        let rows = json.rows || [];
        if(q){
          rows = rows.filter(r => 
            (r.application_id||'').toLowerCase().includes(q) ||
            (r.first_name||'').toLowerCase().includes(q) ||
            (r.last_name||'').toLowerCase().includes(q) ||
            (r.email||'').toLowerCase().includes(q)
          );
        }

        tbody.innerHTML = '';
        if(rows.length === 0){
          table.style.display = 'none';
          empty.style.display = 'block';
          statusEl.textContent = 'No applications found';
          return;
        }
        table.style.display = 'table';
        empty.style.display = 'none';

        for(const r of rows){
          const tr = document.createElement('tr');
          tr.innerHTML = \`
            <td>\${esc(r.application_id)}</td>
            <td>\${esc(r.first_name)} \${esc(r.last_name)}</td>
            <td>\${esc(r.email)}</td>
            <td>\${esc(r.phone_full||'')}</td>
            <td>\${esc(r.address1)}\${r.address2?'<br><span style="color:#bbdefb;font-size:12px">'+esc(r.address2)+'</span>':''}</td>
            <td>\${esc(r.parish||'')}</td>
            <td>\${esc(r.term_months??'')}</td>
            <td>\${esc(r.promotion_id??'')}</td>
            <td>\${fmtDate(r.created_at)}</td>
          \`;
          tbody.appendChild(tr);
        }
        statusEl.textContent = \`Loaded \${rows.length} row(s)\`;
      } catch(e){
        statusEl.textContent = 'Network error';
      }
    }

    // events
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('refresh-btn').addEventListener('click', fetchApplications);
      document.getElementById('limit').addEventListener('change', fetchApplications);
      let t; document.getElementById('search').addEventListener('input', () => { clearTimeout(t); t = setTimeout(fetchApplications, 250); });
      fetchApplications();
    });

    document.querySelector('.mobile-menu-btn').addEventListener('click', () => alert('Menu placeholder'));
  </script>
</body>
</html>
